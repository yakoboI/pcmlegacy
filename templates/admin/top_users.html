{% extends "admin/admin_base.html" %}

{% block title %}Top 10 Users - Admin{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h1>üèÜ Top 10 Users Management</h1>
        <p>Top users are automatically calculated based on visit days (number of days user visited the website), downloads, and activity. You can set admin gift amounts and status.</p>
        <p style="color: #6c757d; font-size: 0.875rem; margin-top: 0.5rem;">
            <strong>Ranking Criteria:</strong> Visit Days (40%) + Downloads (50%) + Activity (10%)
        </p>
    </div>
    
    <div class="top-users-table">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>S/N</th>
                    <th>User</th>
                    <th>Days/Month</th>
                    <th>Downloads</th>
                    <th>Admin Gift</th>
                    <th>Status</th>
                    <th>Visible</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% if top_users %}
                    {% for user_data in top_users %}
                    <tr>
                        <td class="serial-number">{{ user_data.serial_number }}</td>
                        <td>
                            <strong>{{ user_data.user.get_full_name() }}</strong><br>
                            <small>{{ user_data.user.email }}</small><br>
                            <small style="color: #6c757d;">Visit Days: {{ user_data.unique_visit_days }} | Score: {{ "{:.1f}".format(user_data.score) }}</small>
                        </td>
                        <td>{{ user_data.days_or_months }}</td>
                        <td class="downloads">{{ user_data.total_downloads }}</td>
                        <td class="admin-gift">
                            {% if user_data.get('admin_gift') %}
                                TZS {{ "{:,.0f}".format(user_data.admin_gift) }}
                            {% else %}
                                TZS 0
                            {% endif %}
                        </td>
                        <td>
                            <span class="status-badge status-{{ user_data.get('status', 'active') }}">
                                {{ user_data.get('status', 'active').title() }}
                            </span>
                        </td>
                        <td>
                            {% if user_data.get('is_visible', True) %}
                                <span class="badge badge-success">Yes</span>
                            {% else %}
                                <span class="badge badge-secondary">No</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="action-buttons">
                                <a href="{{ url_for('admin_edit_top_user', user_id=user_data.user.id) }}" class="btn btn-sm btn-primary">
                                    ‚úèÔ∏è Set Gift
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="8" class="no-data">
                            <p>No top users calculated yet. Users are automatically ranked based on visit days, downloads, and activity.</p>
                        </td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>

<script>
</script>

<style>
.admin-header {
    margin-bottom: 2rem;
}

.top-users-table {
    background: white;
    border: 1px solid #000000;
    overflow-x: auto;
}

.admin-table {
    width: 100%;
    border-collapse: collapse;
}

.admin-table th {
    background: #f0f0f0;
    padding: 1rem;
    text-align: left;
    font-weight: 600;
    color: var(--text-primary);
    border-bottom: 1px solid #000000;
    border: 1px solid #000000;
}

.admin-table td {
    padding: 1rem;
    border-bottom: 1px solid #000000;
    border: 1px solid #000000;
    vertical-align: middle;
}

.admin-table tr:last-child td {
    border-bottom: none;
}

.serial-number {
    font-weight: bold;
    font-size: 1.25rem;
    color: #2563eb;
    text-align: center;
    width: 80px;
}

.admin-gift {
    font-weight: 600;
    color: #28a745;
}

.status-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 0;
    font-size: 0.75rem;
    font-weight: bold;
    border: 1px solid #000000;
    display: inline-block;
}

.status-active {
    background: #28a745;
    color: white;
}

.status-inactive {
    background: #6c757d;
    color: white;
}

.status-featured {
    background: #ffc107;
    color: #000000;
}

.badge {
    padding: 0.25rem 0.5rem;
    border-radius: 0;
    font-size: 0.75rem;
    font-weight: bold;
    border: 1px solid #000000;
}

.badge-success {
    background: #28a745;
    color: white;
}

.badge-secondary {
    background: #6c757d;
    color: white;
}

.action-buttons {
    display: flex;
    gap: 0.5rem;
}

.btn-sm {
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
}

.no-data {
    text-align: center;
    padding: 3rem 1rem;
    color: var(--text-secondary);
}

@media (max-width: 768px) {
    .admin-header {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .top-users-table {
        overflow-x: auto;
    }
    
    .admin-table {
        min-width: 800px;
    }
}
</style>
{% endblock %}

