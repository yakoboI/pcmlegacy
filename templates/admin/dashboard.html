{% extends "admin/admin_base.html" %}

{% block title %}Admin Dashboard - Pcmlegacy{% endblock %}

{% block content %}
<div class="admin-dashboard">
    <div class="admin-welcome">
        <h2>Welcome back, {{ current_user.first_name if current_user and current_user.is_authenticated else 'Admin' }}!</h2>
        <p>Here's what's happening with your store.</p>
    </div>
    
    
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">üë•</div>
            <div class="stat-content">
                <h3>{{ total_users }}</h3>
                <p>Total Users</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">üìö</div>
            <div class="stat-content">
                <h3>{{ total_materials }}</h3>
                <p>Materials</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">‚≠ê</div>
            <div class="stat-content">
                <h3>{{ active_subscriptions }}</h3>
                <p>Active Subscriptions</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">üìã</div>
            <div class="stat-content">
                <h3>{{ total_plans }}</h3>
                <p>Subscription Plans</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">üë•</div>
            <div class="stat-content">
                <h3>{{ total_visitors }}</h3>
                <p>Total Visitors</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">üÜï</div>
            <div class="stat-content">
                <h3>{{ unique_visitors }}</h3>
                <p>Unique Visitors</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">üìÑ</div>
            <div class="stat-content">
                <h3>{{ total_page_views }}</h3>
                <p>Page Views</p>
            </div>
        </div>
    </div>
    
    
    <div class="quick-actions">
        <h2>Quick Actions</h2>
        <div class="action-buttons">
            <a href="{{ url_for('admin_add_material') }}" class="btn btn-primary">
                <span class="btn-icon">‚ûï</span>
                Add New Material
            </a>
            <a href="{{ url_for('admin_materials') }}" class="btn btn-secondary">
                <span class="btn-icon">üìö</span>
                Manage Materials
            </a>
            <a href="{{ url_for('admin_users') }}" class="btn btn-secondary">
                <span class="btn-icon">üë•</span>
                Manage Users
            </a>
            <a href="{{ url_for('admin_subscriptions') }}" class="btn btn-primary">
                <span class="btn-icon">‚≠ê</span>
                Manage Subscriptions
            </a>
            <a href="{{ url_for('admin_mobile_payments') }}" class="btn btn-secondary">
                <span class="btn-icon">üì±</span>
                Mobile Payments
            </a>
            <a href="{{ url_for('admin_visitor_stats') }}" class="btn btn-info">
                <span class="btn-icon">üìä</span>
                Visitor Statistics
            </a>
            <a href="{{ url_for('admin_news') }}" class="btn btn-success">
                <span class="btn-icon">üì∞</span>
                News Management
            </a>
            <a href="/admin/terms-of-service" class="btn btn-primary">
                <span class="btn-icon">üìú</span>
                Terms of Service
            </a>
        </div>
    </div>
    
    
    <div class="dashboard-grid">
        
        <div class="dashboard-card">
            <div class="card-header">
                <h3>Recent Materials</h3>
                <a href="{{ url_for('admin_materials') }}" class="card-link">View All</a>
            </div>
            <div class="card-content">
                {% if recent_materials %}
                    <div class="material-list">
                        {% for material in recent_materials %}
                        <div class="material-item">
                            <div class="material-info">
                                <div class="material-title">{{ material.title }}</div>
                                <div class="material-category">{{ material.category.name if material.category else 'No Category' }}</div>
                                <div class="material-date">{{ material.created_at.strftime('%Y-%m-%d') }}</div>
                            </div>
                            <div class="material-status">
                                <span class="status-badge status-{{ 'active' if material.is_active else 'inactive' }}">
                                    {{ 'Active' if material.is_active else 'Inactive' }}
                                </span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="no-data">No materials added yet</p>
                {% endif %}
            </div>
        </div>
        
        
        <div class="dashboard-card">
            <div class="card-header">
                <h3>Recent Subscriptions</h3>
                <a href="{{ url_for('admin_subscriptions') }}" class="card-link">View All</a>
            </div>
            <div class="card-content">
                {% if recent_subscriptions %}
                    <div class="subscription-list">
                        {% for subscription in recent_subscriptions %}
                        <div class="subscription-item">
                            <div class="subscription-info">
                                <div class="subscription-user">{{ subscription.user.get_full_name() }}</div>
                                <div class="subscription-plan">
                                    Custom Plan
                                </div>
                                <div class="subscription-date">{{ subscription.created_at.strftime('%Y-%m-%d') }}</div>
                            </div>
                            <div class="subscription-status">
                                <span class="status-badge status-{{ 'active' if subscription.is_active else 'inactive' }}">
                                    {{ subscription.status_text }}
                                </span>
                                <div class="subscription-details">
                                    <div class="subscription-materials">{{ subscription.materials_accessed }}/{{ subscription.max_materials }} materials</div>
                                    <div class="subscription-days">{{ subscription.days_remaining }} days left</div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="no-data">No subscriptions yet</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<style>
.material-list,
.subscription-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.material-item,
.subscription-item {
    display: flex;
    justify-content: space-between;
    align-items: stretch;
    gap: 1rem;
    padding: 1rem;
    background: var(--surface-color);
    border: 1px solid var(--border-color);
    box-shadow: var(--shadow);
}

.material-info,
.subscription-info {
    flex: 1;
}

.material-title,
.subscription-user {
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 0.25rem;
}

.material-category,
.subscription-plan {
    color: var(--secondary-color);
    font-size: 0.875rem;
    margin-bottom: 0.25rem;
}

.material-date,
.subscription-date {
    color: var(--text-secondary);
    font-size: 0.75rem;
}

.material-status,
.subscription-status {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 0.5rem;
    min-width: 160px;
}

.subscription-details {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    color: var(--text-secondary);
    font-size: 0.75rem;
    text-align: right;
}

@media (max-width: 768px) {
    .dashboard-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
    }

    .material-item,
    .subscription-item {
        flex-direction: column;
        align-items: flex-start;
        padding: 0.875rem;
    }

    .material-status,
    .subscription-status {
        width: 100%;
        min-width: auto;
        align-items: flex-start;
    }

    .subscription-details {
        text-align: left;
        font-size: 0.8125rem;
    }
}
</style>
{% endblock %}

{% block scripts %}
<script>
// Auto-refresh dashboard data every 30 seconds
setInterval(function() {
    // In a real application, you might want to refresh specific data
    // For now, we'll just update the page timestamp
    console.log('Dashboard data refreshed at:', new Date().toLocaleTimeString());
}, 30000);

// Add click handlers for quick actions
document.querySelectorAll('.action-buttons .btn').forEach(btn => {
    btn.addEventListener('click', function(e) {
        // Add loading state
        this.classList.add('loading');
        setTimeout(() => {
            this.classList.remove('loading');
        }, 1000);
    });
});
</script>
{% endblock %}
